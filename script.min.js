// Загрузка Google Charts
google.charts.load('current', { packages: ['corechart'] });
google.charts.setOnLoadCallback(() => {
  drawCostChart();
  drawSalesChart();
  drawExpensesChart();
  drawIncomeChart();
});

// Функция для рисования графика себестоимости
function drawCostChart() {
  const data = google.visualization.arrayToDataTable([
    ['Параметр', 'Вартість (грн)'],
    ['Смола', 88],
    ['Форма', 40],
    ['Додаткові матеріали', 50],
    ['Енерговитрати', 20],
    ['Реклама', 60],
  ]);

  const options = {
    title: 'Розподіл собівартості виробу',
    is3D: true,
    backgroundColor: 'transparent',
    titleTextStyle: { fontSize: 18, bold: true },
    legend: { textStyle: { fontSize: 14 } },
    chartArea: { width: '80%', height: '70%' },
  };

  const chart = new google.visualization.PieChart(document.getElementById('costChart'));
  chart.draw(data, options);
  window.addEventListener('resize', () => chart.draw(data, options));
}

// Функция для рисования графика прогноза продаж
function drawSalesChart() {
  const data = google.visualization.arrayToDataTable([
    ['Місяць', 'Продажі (шт)', 'Дохід (грн)', 'Прибуток (грн)'],
    ['Місяць 1', 100, 80000, 2400],
    ['Місяць 2', 120, 96000, 13240],
    ['Місяць 3', 150, 120000, 29500],
    ['Місяць 4', 180, 144000, 45760],
    ['Місяць 5', 200, 160000, 56600],
    ['Місяць 6', 220, 176000, 67440],
    ['Місяць 7', 210, 168000, 61420],
    ['Місяць 8', 190, 152000, 50580],
    ['Місяць 9', 170, 136000, 39740],
    ['Місяць 10', 150, 120000, 29500],
    ['Місяць 11', 130, 104000, 19260],
    ['Місяць 12', 110, 88000, 8420],
  ]);

  const options = {
    title: 'Прогноз продаж, доходу та прибутку на 12 місяців',
    curveType: 'function',
    legend: { position: 'bottom' },
    backgroundColor: 'transparent',
    titleTextStyle: { fontSize: 18, bold: true },
    hAxis: { title: 'Місяць', titleTextStyle: { fontSize: 14 } },
    vAxis: { title: 'Гривні', titleTextStyle: { fontSize: 14 } },
    chartArea: { width: '80%', height: '70%' },
    colors: ['#1a73e8', '#34a853', '#fbbc05'],
    tooltip: { isHtml: true },
  };

  const chart = new google.visualization.LineChart(document.getElementById('salesChart'));
  chart.draw(data, options);
  window.addEventListener('resize', () => chart.draw(data, options));
}

// Функция для рисования графика витрат
function drawExpensesChart() {
  const data = google.visualization.arrayToDataTable([
    ['Категорія', 'Сума (грн)'],
    ['Стартові витрати', 1500 * 38],
    ['Щомісячні витрати', 51800],
    ['Собівартість виробу', 258 * 1000],
  ]);

  const options = {
    title: 'Розподіл витрат',
    pieHole: 0.4,
    backgroundColor: 'transparent',
    titleTextStyle: { fontSize: 18, bold: true },
    legend: { textStyle: { fontSize: 14 } },
  };

  const chart = new google.visualization.PieChart(document.getElementById('expensesChart'));
  chart.draw(data, options);
}

// Функция для рисования графика доходів
function drawIncomeChart() {
  const data = google.visualization.arrayToDataTable([
    ['Категорія', 'Сума (грн)'],
    ['Дохід від продажів', 9600000],
    ['Прибуток до податків', 5882400],
    ['Прибуток після податків', 4735332],
  ]);

  const options = {
    title: 'Розподіл доходів',
    bars: 'horizontal',
    backgroundColor: 'transparent',
    titleTextStyle: { fontSize: 18, bold: true },
    legend: { textStyle: { fontSize: 14 } },
  };

  const chart = new google.visualization.BarChart(document.getElementById('incomeChart'));
  chart.draw(data, options);
}

// Валидация форм
document.querySelectorAll('form').forEach(form => {
  form.addEventListener('submit', function (e) {
    e.preventDefault();
    let isValid = true;
    form.querySelectorAll('input').forEach(input => {
      if (!input.checkValidity()) {
        input.classList.add('is-invalid');
        isValid = false;
      } else {
        input.classList.remove('is-invalid');
      }
    });
    if (isValid) {
      if (form.id === 'costForm') calculateCost();
      if (form.id === 'calculationForm') calculateProfit();
    }
  });
});

// Кнопка "Наверх"
const scrollToTopBtn = document.getElementById('scrollToTopBtn');
window.addEventListener('scroll', () => {
  scrollToTopBtn.style.display = window.scrollY > 500 ? 'block' : 'none';
});
scrollToTopBtn.addEventListener('click', () => {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});